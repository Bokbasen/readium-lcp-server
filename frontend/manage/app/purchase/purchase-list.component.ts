import { Component, OnInit } from '@angular/core';

import * as moment from 'moment';

import { Purchase }          from './purchase';
import { PurchaseService }   from './purchase.service';

declare var Config: any; //  this comes from the autogenerated config.js file

@Component({
    moduleId: module.id,
    selector: 'lcp-purchase-list',
    templateUrl: 'purchase-list.component.html'
})

export class PurchaseListComponent implements OnInit {
    purchases: Purchase[];

    constructor(private purchaseService: PurchaseService) {
        this.purchases = [];
    }

    refreshPurchases(): void {
        this.purchaseService.list().then(
            purchases => {
                this.purchases = purchases;
            }
        );
    }

    buildLcplDownloadUrl(id: number): string {
        return Config.frontend.url + '/api/v1/purchases/' + id + '/license';
    }

    formatDate(date: string): string {
        return moment(date).format('YYYY-MM-DD HH:mm:ss');
    }

    ngOnInit(): void {
        this.refreshPurchases();
    }

    onRemove(objId: any): void {
        this.purchaseService.delete(objId).then(
            purchase => {
                this.refreshPurchases();
            }
        );
    }
 }
