<!doctype html>
<html>
  <head>
    <script src="//code.jquery.com/jquery-2.0.3.min.js" type="text/javascript"></script>
    <link href='http://fonts.googleapis.com/css?family=Lato:400,900' rel='stylesheet' type='text/css'>

    <style>
      body { font-family: 'Lato', sans-serif;
             background-color: #59657F;
             color: white }

      .dropping {
        border-color: white;
        color: #59657F;
      }
      #dropzone {
        text-transform: uppercase;
        border: 2px solid #2C3340;
        background: #2C3340;
      }
      h1 {
        font-size: 16px
      }
    </style>
  </head>
  <body>
    <h1>LCPServer Admin</h1>
    <div id="dropzone">Drag here to upload</div>
  </body>
    <script language="javascript" type="text/javascript">
      var obj = $("#dropzone");
      obj.on('dragenter', function (e) {
          console.log(this);
          $(this).addClass("dropping")
          e.stopPropagation();
          e.preventDefault();
      });
      obj.on('dragover', function (e) {
          e.stopPropagation();
          e.preventDefault();
          });
    obj.on('drop', function (e) {
        $(this).removeClass("dropping")
        e.preventDefault();
        var files = e.originalEvent.dataTransfer.files;
        //We need to send dropped files to Server
        handleFileUpload(files,obj);
    });

$(document).on('dragenter', function (e) {
    $('#dropzone').addClass("dropping")
    e.stopPropagation();
    e.preventDefault();
    });
$(document).on('dragover', function (e) {
    e.stopPropagation();
    e.preventDefault();
    });
$(document).on('drop', function (e) {
    $(this).removeClass("dropping")
    e.preventDefault();
    var files = e.originalEvent.dataTransfer.files;
    handleFileUpload(files,obj);
    });


function handleFileUpload(files,obj) {
  
  for (var i = 0; i < files.length; i++) {
    $('#dropzone').css('background', '-webkit-linear-gradient(left, #2C3340 0%,#2C3340 0%,transparent 0%)')
    var uploadURL ="/api/store/" + files[i].name; //Upload URL
    var req = new XMLHttpRequest();
    req.upload.onprogress = function(e) {
      if (e.lengthComputable) {
        var prog = Math.ceil((e.loaded / e.total) * 100);
        $('#dropzone').css('background', '-webkit-linear-gradient(left, #2C3340 ' + prog + '%,#2C3340 ' + prog + '%,transparent 0%)');
      }
    }
    req.onload = function(event) {
      refreshPackages();
    }
    req.open("POST", uploadURL, true);
    req.send(files[i]);
    
  }
}

function refreshPackages() {
  var req = new XMLHttpRequest();
  req.onload =  function() {
    $('#packages').html('');
    data = JSON.parse(this.response);
    for(i in data) {
      $('#packages').append('<li>' + data[i].key + '</li>')
    }
  }
  req.open("GET", "/api/packages");
  req.send();
}
$(function() {
  refreshPackages()
    })
    </script>
    <ul id="packages"></ul>
</html>
